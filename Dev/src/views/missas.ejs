<%- include("includes/header"); %>

<%- include("includes/navbar"); %>

<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.19/index.global.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/bootstrap5@6.1.19/index.global.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css" rel="stylesheet">
<script>
  document.addEventListener("DOMContentLoaded", function() {
    
    const missasDoServidor = <%- JSON.stringify(missas) %>;
    const missas = [];
    for (missa of missasDoServidor){
      let missa_tratada = {};
      missa_tratada.title = missa.titulo;
      missa_tratada.start = missa.data_hora;  
      missas.push(missa_tratada);
    } 
    
    var calendarEl = document.getElementById("calendar");
    var calendar = new FullCalendar.Calendar(calendarEl, {
      titleFormat: { year: "numeric", month:"long" },
        themeSystem: "bootstrap5",
        initialView: "dayGridMonth",
        locale: "pt-br",
        height: "auto",
        navLinks: "true",
        navLinkDayClick: function(date, jsEvent) {
          const dataOBJ = new Date(date)
          const data_atual = dataOBJ.toISOString().split('T')[0];
          document.getElementById("data_atual").value = data_atual;
          console.log(document.getElementById("data_atual").value)
          document.getElementById("formulario_data_atual").submit();
        },
        events: missas
      });

    calendar.render();

    
    const botao_hoje = document.querySelector(".fc-today-button");  
    botao_hoje.innerHTML = "Hoje";  // Inicia o valor do today-button como Hoje
    document.addEventListener("click", function(){  // (útil por causa da mudança de mês) muda o valor do today-button a cada click
      botao_hoje.innerHTML = "Hoje";
    })
  });

</script>



<form id="formulario_data_atual" action="/missas/especifica" method="GET">
  <input type="hidden" id="data_atual" name="data_atual" value="">
</form>

<div class="mt-4 mx-5">
  <a href="/missas/new" class="btn btn-primary text text-white fw-semibold">Cadastrar Nova Missa</a>  
  <a href="/missas/new_recorrente" class="btn btn-primary text text-white fw-semibold">Cadastrar Missa Recorrente</a>  
  <div id="calendar" class="border border-dark border-2 rounded-3 shadow-lg mt-1 p-2"></div>
</div>

<style>
/* Torna maiuscula a primeira letra do título da toolbar*/
.fc-toolbar-title {
    text-transform: capitalize;
}
.fc-today-button {
  font-weight: 600;
}
</style>


<%- include("includes/footer"); %>